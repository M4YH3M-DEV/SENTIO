; PlatformIO Configuration for SENTIO ESP32 Servo Bridge
; Optimized for production with OTA support, comprehensive logging, and watchdog

[platformio]
default_envs = esp32doit-devkit-v1
extra_configs = 
    platformio.ini.local
description = SENTIO Robot Servo Bridge Firmware

[env]
framework = arduino
lib_deps =
    adafruit/Adafruit PCA9685 Library @ ^1.4.1
    ArduinoJson @ ^6.20.0
    AsyncTCP @ ^1.1.1
    ESP Async WebServer @ ^1.2.3

build_flags =
    -DCORE_DEBUG_LEVEL=2
    -std=c++17
    -Wall
    -Wextra
    -Werror=format
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections

monitor_speed = 115200
monitor_filters = 
    time
    log2file
    colorize

upload_speed = 921600
upload_protocol = esp32default

; Development environment with debugging
[env:esp32doit-devkit-v1]
platform = espressif32 @ ^6.0.0
board = esp32doit-devkit-v1
build_type = release

build_flags =
    ${env.build_flags}
    -DVERSION="1.0.0"
    -DBUILD_DATE="2025-11-13"
    -DENABLE_DEBUG=1
    -DENABLE_OTA=1

monitor_raw = True
extra_scripts =
    post:extra_script.py

; Production environment (optimized)
[env:esp32doit-devkit-v1-prod]
platform = espressif32 @ ^6.0.0
board = esp32doit-devkit-v1
build_type = release

build_flags =
    ${env.build_flags}
    -DVERSION="1.0.0"
    -DBUILD_DATE="2025-11-13"
    -DENABLE_DEBUG=0
    -DENABLE_OTA=1
    -O3
    -DNDEBUG

; ESP32-S3 variant (optional)
[env:esp32-s3-devkitc-1]
platform = espressif32 @ ^6.0.0
board = esp32-s3-devkitc-1
build_type = release

build_flags =
    ${env.build_flags}
    -DVERSION="1.0.0"
    -DBUILD_DATE="2025-11-13"
    -DENABLE_DEBUG=1
    -DENABLE_OTA=1

upload_speed = 1500000
